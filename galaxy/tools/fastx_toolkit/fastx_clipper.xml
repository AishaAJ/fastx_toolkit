<tool id="cshl_fastx_clipper" name="Clip" version="1.0.1" >
  <description>adapter sequences</description>
  <command>
    zcat -f $input | fastx_clipper $GZIPOUT -s $maxmismatches -l $minlength -a $clip_source.clip_sequence -d $keepdelta -o $output -v $KEEP_N $DISCARD_OPTIONS
  </command>
  
  <inputs>
    <param format="fasta,fastqsolexa" name="input" type="data" label="Library to clip" />
    
    <param name="maxmismatches" size="4" type="integer" value="2">
      <label>Maximum number of mismatches allowed (when matching the adapter sequence)</label>
    </param>
  
    <param name="minlength" size="4" type="integer" value="15">
      <label>Minimum sequence length (after clipping, sequences shorter than this length will be discarded)</label>
    </param>

	<conditional name="clip_source">
		<param name="clip_source_list" type="select" label="Source">
			<option value="prebuilt" selected="true">Standard (select from the list below)</option>
			<option value="user">Enter custom sequence</option>
		</param>

		<when value="user">
			<param name="clip_sequence" size="30" label="Enter custom clipping sequence" type="text" value="CTGTAGGCACCATCAATC" />
		</when>

		<when value="prebuilt">
			<param name="clip_sequence" type="select" label="Choose modban">
				<options from_file="cshl_modban_sequences.txt">
					<column name="name" index="1"/>
					<column name="value" index="0"/>
				</options>
			</param> 
		</when>
	</conditional>

	<param name="keepdelta" size="2" type="integer" value="0">
		<label>enter non-zero value to keep the modban sequence and x bases that follow it</label>
		<help>use this for hairpin barcoding. keep at 0 unless you know what you're doing.</help>
	</param>

	<param name="KEEP_N" type="select" label="Discard sequences with unknown (N) bases">
		<option value="">Yes</option>
		<option value="-n">No</option>
	</param>

	<param name="DISCARD_OPTIONS" type="select" label="Output options">
		<option value="-c">Output only clipped seqeunces (i.e. sequences which contained the adapter)</option>
		<option value="-C">Output only non-clipped seqeunces (i.e. sequences which did not contained the adapter)</option>
		<option value="">Output both clipped and non-clipped sequences</option>
	</param>

	   <param name="GZIPOUT" type="select" label="Compress output file (using GZIP) ">
	      <option value="-z">yes</option>
	      <option value="">no</option>
	   </param>


  </inputs>

	<tests>
		<test>
			<!-- Clip a FASTQ file -->
			<param name="input" value="fastx_clipper1.fastq" />
			<param name="maxmismatches" value="2" />
			<param name="minlength" value="15" />
			<param name="clip_source.clip_source_list" value="user" />
			<param name="clip_source.clip_sequence" value="CAATTGGTTAATCCCCCTATATA" />
			<param name="keepdelta" value="0" />
			<param name="KEEP_N" value="-n" />
			<param name="DISCARD_OPTIONS" value="-c" />
			<param name="GZIPOUT" value=""/>
			<output name="output" file="fastx_clipper1a.out" />
		</test>
	</tests>

  <outputs>
    <data format="input" name="output" label="$input.tag clipped" metadata_source="input" />
  </outputs>
  
<help>
**What it does**

This tool clips adapters from sequences in a FASTA/FASTQ file.

--------

Written by Assaf Gordon (gordon@cshl.edu), based on Oliver Tam (tam@cshl.edu) and Ted Karginov's (karginov@cshl.edu) clipper.

</help>
</tool>
